<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head') %>

    <style>
      body {
        background: #f8f9fa;
        margin: 0;
        padding: 0;
      }
      h1,
      h2,
      h3 {
        color: #343a40;
      }
      .form-section {
        background: #fff;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 3rem;
        border: 1px solid #e3e3e3;
      }
      .form-group label {
        font-weight: 600;
      }
      .btn {
        border-radius: 20px;
      }
      .btn-primary {
        min-width: 130px;
      }
      .form-floating-label {
        position: relative;
        margin-bottom: 1.5rem;
      }

      .form-floating-label {
        position: relative;
        margin-bottom: 1.5rem;
      }

      .form-floating-label textarea {
        width: 100%;
        padding: 1.2rem 0.75rem 0.4rem 0.75rem;
        font-size: 0.95rem;
        border: 2px solid #1a73e8;
        border-radius: 5px;
        resize: vertical;
        line-height: 1.3;
        min-height: 60px; /* adjust to make it compact */
      }

      .form-floating-label label {
        position: absolute;
        top: 10px;
        left: 12px;
        background: white;
        padding: 0 4px;
        color: #1a73e8;
        font-size: 0.85rem;
        pointer-events: none;
        transition: 0.2s ease;
      }

      .form-floating-label textarea:focus + label,
      .form-floating-label textarea:not(:placeholder-shown) + label {
        top: -10px;
        left: 10px;
        font-size: 0.75rem;
        background: white;
      }
    </style>
  </head>

  <body>
    <%- include('../partials/sidebar') %>
    <div class="dashboard-main-wrapper">
      <div
        class="top-navbar flex-between gap-16"
        style="background-color: white"
      >
        <div class="flex-align gap-16">
          <!-- Toggle Button Start -->
          <button
            type="button"
            class="toggle-btn d-xl-none d-flex text-26 text-gray-500"
          >
            <i class="ph ph-list"></i>
          </button>
          <!-- Toggle Button End -->

          <h1>Event</h1>
        </div>

        <div class="flex-align gap-16">
          <a
            href="/admin/logout"
            class="py-12 text-15 px-20 hover-bg-danger-50 text-gray-300 hover-text-danger-600 rounded-8 flex-align gap-8 fw-medium text-15"
          >
            <span class="text-2xl text-danger-600 d-flex"
              ><i class="ph ph-sign-out"></i
            ></span>
            <span class="text">Log Out</span>
          </a>
        </div>
      </div>
      <!-- Form Collapse Container -->
      <div class="collapse" id="eventForm">
        <div class="card card-body shadow-lg rounded">
          <form action="/add-event" method="POST" enctype="multipart/form-data">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Event Name</label>
                <input
                  type="text"
                  name="name"
                  class="form-control"
                  placeholder="Event Name"
                  required
                />
              </div>
              <div class="form-group col-md-6">
                <label>Event Date</label>
                <input
                  type="date"
                  name="eventDate"
                  class="form-control"
                  required
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Email</label>
                <input
                  type="email"
                  name="email"
                  class="form-control"
                  placeholder="Email"
                />
              </div>
              <div class="form-group col-md-6">
                <label>Website</label>
                <input
                  type="text"
                  name="website"
                  class="form-control"
                  placeholder="Website"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Organiser</label>
                <input
                  type="text"
                  name="organiser"
                  class="form-control"
                  placeholder="Organiser"
                />
              </div>
              <div class="form-group col-md-6">
                <label>Map Location (Embed Link)</label>
                <input
                  type="text"
                  name="mapLocation"
                  class="form-control"
                  placeholder="Map Embed URL"
                />
              </div>
            </div>

            <div class="form-group">
              <label>Event Image</label>
              <input type="file" name="eventImage" class="form-control-file" />
            </div>

            <hr class="my-4" />

            <!-- Editable Content Areas -->
            <div class="form-group">
              <label>Content</label>
              <textarea
                name="content"
                class="form-control summernote"
                placeholder="Main Content"
              ></textarea>
            </div>

            <div class="form-group">
              <label>Details</label>
              <textarea
                name="details"
                class="form-control summernote"
                placeholder="Event Details"
              ></textarea>
            </div>

            <div class="form-group">
              <label>Venue</label>
              <textarea
                name="venue"
                class="form-control summernote"
                placeholder="Venue Info"
              ></textarea>
            </div>

            <!-- SEO Fields -->
            <div class="form-row">
              <div class="form-group col-md-4">
                <label>Meta Title</label>
                <input
                  type="text"
                  name="metaTitle"
                  class="form-control"
                  placeholder="Meta Title"
                />
              </div>
              <div class="form-group col-md-4">
                <label>Meta Description</label>
                <input
                  type="text"
                  name="metaDescription"
                  class="form-control"
                  placeholder="Meta Description"
                />
              </div>
              <div class="form-group col-md-4">
                <label>Meta Keywords</label>
                <input
                  type="text"
                  name="metaKeywords"
                  class="form-control"
                  placeholder="Meta Keywords"
                />
              </div>
            </div>

            <div class="text-center">
              <button type="submit" class="btn btn-success px-5">
                Submit Event
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="container mt-5">
        <h2 class="mb-4">All Events</h2>
        <!-- Toggle Button -->
        <div class="text-center my-4">
          <button
            class="btn btn-primary"
            type="button"
            data-toggle="collapse"
            data-target="#eventForm"
            aria-expanded="false"
            aria-controls="eventForm"
          >
            Add new Event +
          </button>
        </div>

        <table class="table table-bordered table-hover">
          <thead class="thead-dark">
            <tr>
              <th>Name</th>
              <th>Image</th>

              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (events && events.length > 0) { %> <%
            events.forEach(function(event) { %>
            <tr>
              <td><%= event.name %></td>
              <td>
                <% if (event.eventImage) { %>
                <img
                  src="<%= event.eventImage %>"
                  width="100"
                  height="80"
                  style="object-fit: cover"
                />
                <% } else { %> No image <% } %>
              </td>
              <td>
                <a
                  href="/edit-event/<%= event._id %>"
                  class="btn btn-sm btn-primary"
                  >Edit</a
                >

                <button
                  class="btn btn-sm btn-danger"
                  data-toggle="modal"
                  data-target="#deleteModal<%= event._id %>"
                >
                  Delete
                </button>

                <!-- Delete Confirmation Modal -->
                <div
                  class="modal fade"
                  id="deleteModal<%= event._id %>"
                  tabindex="-1"
                  role="dialog"
                  aria-labelledby="deleteModalLabel<%= event._id %>"
                  aria-hidden="true"
                >
                  <div
                    class="modal-dialog modal-dialog-centered"
                    role="document"
                  >
                    <div class="modal-content">
                      <div class="modal-header bg-danger text-white">
                        <h5
                          class="modal-title"
                          id="deleteModalLabel<%= event._id %>"
                        >
                          Confirm Deletion
                        </h5>
                        <button
                          type="button"
                          class="close text-white"
                          data-dismiss="modal"
                          aria-label="Close"
                        >
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to delete the event "<strong
                          ><%= event.name %></strong
                        >"?
                      </div>
                      <div class="modal-footer">
                        <form
                          action="/delete-event/<%= event._id %>"
                          method="POST"
                        >
                          <button type="submit" class="btn btn-danger">
                            Yes, Delete
                          </button>
                        </form>
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-dismiss="modal"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="7" class="text-center text-muted">
                No events available.
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>


      <!-- Required Scripts -->
      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-bs4.min.js"></script>

      <!-- Summernote Init Script -->
      <script src="/js/script.js"></script>
      <script>
        $(document).ready(function () {
          $(".summernote").summernote({
            height: 200,
          });
        });
      </script>
    </div>
  </body>
</html>
